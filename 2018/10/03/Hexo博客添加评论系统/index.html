<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Hexo博客添加评论系统 | ZZY补完计划</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hexo,博客,教程,评论,gitalk">
    <meta name="description" content="很多人写博客的目的是给自己做记录的，例如我，但是一个使用难免会有些寂寞，有时候会想要让跟多人看见自己的成果，这时候就需要可以互动评论的系统。现在的博客评论插件系统很多，尝试了一番，最终选择使用 gitalk 评论系统。">
<meta name="keywords" content="Hexo,博客,教程,评论,gitalk">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo博客添加评论系统">
<meta property="og:url" content="https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/index.html">
<meta property="og:site_name" content="ZZY补完计划">
<meta property="og:description" content="很多人写博客的目的是给自己做记录的，例如我，但是一个使用难免会有些寂寞，有时候会想要让跟多人看见自己的成果，这时候就需要可以互动评论的系统。现在的博客评论插件系统很多，尝试了一番，最终选择使用 gitalk 评论系统。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f602.png?v8">
<meta property="og:updated_time" content="2020-05-12T01:17:23.859Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo博客添加评论系统">
<meta name="twitter:description" content="很多人写博客的目的是给自己做记录的，例如我，但是一个使用难免会有些寂寞，有时候会想要让跟多人看见自己的成果，这时候就需要可以互动评论的系统。现在的博客评论插件系统很多，尝试了一番，最终选择使用 gitalk 评论系统。">
<meta name="twitter:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8">
    
        <link rel="alternate" type="application/atom+xml" title="ZZY补完计划" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">zzycreate</h5>
          <a href="mailto:zzycreate@gmail.com" title="zzycreate@gmail.com" class="mail">zzycreate@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/collections"  >
                <i class="icon icon-lg icon-star"></i>
                收藏
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                友情链接
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zzycreate" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/abort"  >
                <i class="icon icon-lg icon-user"></i>
                Abort
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Hexo博客添加评论系统</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Hexo博客添加评论系统</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-10-03T12:24:25.000Z" itemprop="datePublished" class="page-time">
  2018-10-03
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/教程/">教程</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#评论系统选型"><span class="post-toc-number">1.</span> <span class="post-toc-text">评论系统选型</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Gitalk-的使用"><span class="post-toc-number">2.</span> <span class="post-toc-text">Gitalk 的使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gitalk-的准备工作"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">gitalk 的准备工作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#阅读说明"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">阅读说明</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#GitHub-Application"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">GitHub Application</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#indigo-主题集成-gitalk"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">indigo 主题集成 gitalk</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#gitalk-ejs"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">gitalk.ejs</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#comment-ejs"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">comment.ejs</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#config-yml"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">_config.yml</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#集成中的问题"><span class="post-toc-number">3.</span> <span class="post-toc-text">集成中的问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gitalk-使用的-id-超限"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">gitalk 使用的 id 超限</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#id-使用-pathname-而不要使用-href"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">id 使用 pathname 而不要使用 href</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结束"><span class="post-toc-number">4.</span> <span class="post-toc-text">结束</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Hexo博客添加评论系统"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Hexo博客添加评论系统</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-10-03 12:24:25" datetime="2018-10-03T12:24:25.000Z"  itemprop="datePublished">2018-10-03</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/教程/">教程</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>很多人写博客的目的是给自己做记录的，例如我，但是一个使用难免会有些寂寞，有时候会想要让跟多人看见自己的成果，这时候就需要可以互动评论的系统。<br>现在的博客评论插件系统很多，尝试了一番，最终选择使用 gitalk 评论系统。</p>
</blockquote>
<a id="more"></a>
<h2 id="评论系统选型"><a href="#评论系统选型" class="headerlink" title="评论系统选型"></a>评论系统选型</h2><p>在之前的 <a href="https://zzycreate.github.io/2018/10/02/Hexo%E5%8D%9A%E5%AE%A2%E6%8A%98%E8%85%BE%E8%AE%B0/" target="_blank" rel="noopener">Hexo博客折腾记</a> 中，选择了一系列可以方便免费开源部署的程序部署了博客，这次也不例外，需要选择免费开源容易部署的评论系统。</p>
<p>我部署的 Hexo 版本为 <code>3.7.0</code>, indigo 主题版本为 <code>1.7.2</code> .<br>这版本的 indigo 主题默认就集成有多种评论系统。这些系统有：</p>
<ol>
<li><code>disqus</code> : <a href="https://disqus.com/" target="_blank" rel="noopener">disqus.com/</a> ———— 界面好看，支持 Facebook、twitter、Google+ 等账号登陆，但是 需要科学上网。</li>
<li><code>友言</code> : <a href="http://www.uyan.cc/" target="_blank" rel="noopener">www.uyan.cc/</a> ———— 系统已经挂了 <img class="github-emoji" title="sweat" alt="sweat" src="https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8" height="20" width="20"></li>
<li><code>gitment</code> : <a href="https://github.com/imsun/gitment">gitment</a> ———— 基于 github issue 系统的评论系统， 已经很长时间没有维护了</li>
<li><code>valine</code> : <a href="https://valine.js.org/" target="_blank" rel="noopener">valine</a> ———— 基于 <a href="https://leancloud.cn/" target="_blank" rel="noopener">Leancloud</a> 的快速、简洁且高效的无后端评论系统</li>
<li><code>Hyper Comments</code> : <a href="https://www.hypercomments.com/" target="_blank" rel="noopener">HyperComments</a> ———— 已于2018.06.15起不再提供免费服务</li>
</ol>
<p>由以上已经支持的集中评论系统来看，很多已经不能使用了。<br>网上看了一下大多数的博客评论系统，以前使用 <a href="https://github.com/duoshuo">多说</a>、网易云更贴 等广受好评的评论系统也都宣布停止服务。</p>
<p>现在做的还可以的评论系统：</p>
<ol>
<li><code>畅言</code> : <a href="https://changyan.kuaizhan.com/" target="_blank" rel="noopener">畅言</a> ———— 搜狐出品，专业的社会化评论系统，需要备案，参考：<a href="https://www.zhihu.com/question/21367928" target="_blank" rel="noopener">知乎 - 搜狐做畅言评论系统的目的是什么？</a></li>
<li><code>valine</code> : <a href="https://valine.js.org/" target="_blank" rel="noopener">valine</a> ———— valine 支持匿名评论</li>
<li><code>来必力</code> : <a href="http://www.laibili.com.cn/" target="_blank" rel="noopener"></a> ———— 来必力是一款以社交网站评论为基础, 帮助用户之间实现自由沟通的内容平台。无需注册, 支持各种社交账号。</li>
<li><code>gitalk</code> : <a href="https://github.com/gitalk/gitalk">gitalk</a> ———— Gitalk 是一个基于 GitHub Issue 和 Preact 开发的评论插件。</li>
</ol>
<p>由于看到众多评论系统相继关闭和停止服务，我觉得评论系统需要有稳定的服务才能够持续为博客提供支持，最终我选择了基于 <code>Github issues</code> 的 gitalk 。毕竟一旦 github 都不能用了的话，当前基于 <code>Github Pages</code> 的博客也会无法使用 <img class="github-emoji" title="joy" alt="joy" src="https://github.githubassets.com/images/icons/emoji/unicode/1f602.png?v8" height="20" width="20"> 。</p>
<h2 id="Gitalk-的使用"><a href="#Gitalk-的使用" class="headerlink" title="Gitalk 的使用"></a>Gitalk 的使用</h2><h3 id="gitalk-的准备工作"><a href="#gitalk-的准备工作" class="headerlink" title="gitalk 的准备工作"></a>gitalk 的准备工作</h3><h4 id="阅读说明"><a href="#阅读说明" class="headerlink" title="阅读说明"></a>阅读说明</h4><p>gitalk 官方中文说明 ： <a href="https://github.com/gitalk/gitalk/blob/master/readme-cn.md">https://github.com/gitalk/gitalk/blob/master/readme-cn.md</a>  </p>
<h4 id="GitHub-Application"><a href="#GitHub-Application" class="headerlink" title="GitHub Application"></a>GitHub Application</h4><p><code>GitHub Application</code> 是 github 提供的应用 Oauth2 授权功能。可以用于外部应用使用 github 提供的账号授权系统。因为 gitalk 的评论使用的是 github issues ，评论必须使用 github 账号，所以用户如果需要使用 gitalk 进行评论，就必须使用自己的 github 账号给这个应用授权。</p>
<p>GitHub Application 的申请地址： <a href="https://github.com/settings/applications/new">Register a new OAuth application</a><br>GitHub Application 的说明文档： <a href="https://link.zhihu.com/?target=https%3A//developer.github.com/v3/oauth/" target="_blank" rel="noopener">Authorizing OAuth Apps</a><br>页面中 <code>Application name</code> 为你的应用名，在用户授权页面展示用。<br>页面中 <code>Homepage URL</code> 为主页URL。<br>页面中 <code>Application description</code> 为应用描述。<br>页面中 <code>Authorization callback URL</code> 为授权回调地址，这个最为关键，需要填写用户授权完成后回调的地址，一般来说就是你的博客地址 xxx.github.io </p>
<p>申请应用之后，就能获得应用的 <code>clientID</code> 和 <code>clientSecret</code> ，这两个东西需要配置到 gitalk 中，而且只会出现一次，请当时就记录下来。</p>
<h3 id="indigo-主题集成-gitalk"><a href="#indigo-主题集成-gitalk" class="headerlink" title="indigo 主题集成 gitalk"></a>indigo 主题集成 gitalk</h3><h4 id="gitalk-ejs"><a href="#gitalk-ejs" class="headerlink" title="gitalk.ejs"></a>gitalk.ejs</h4><p>仿照 gitment 进行改造，在 <code>themes/indigo/layout/_partial/plugins</code> 目录下可以看见 <code>gitment.ejs</code> 文件。<br>这个 ejs 文件是引入 gitment 用的。</p>
<p>类似的在 <code>themes/indigo/layout/_partial/plugins</code> 目录下创建一个名为 <code>gitalk.ejs</code> 的文件。<br>文件类容如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;% if (theme.gitalk.enable)&#123; %&gt;</span><br><span class="line">&lt;section class=&quot;comments&quot; id=&quot;comments&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;gitalk-container&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/gitalk/dist/gitalk.css&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;https://unpkg.com/gitalk/dist/gitalk.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var gitalk = new Gitalk(&#123;</span><br><span class="line">            clientID: &apos;&lt;%- theme.gitalk.client_id %&gt;&apos;,</span><br><span class="line">            clientSecret: &apos;&lt;%- theme.gitalk.client_secret %&gt;&apos;,</span><br><span class="line">            repo: &apos;&lt;%- theme.gitalk.repo %&gt;&apos;,</span><br><span class="line">            owner: &apos;&lt;%- theme.gitalk.owner %&gt;&apos;,</span><br><span class="line">            admin: &apos;&lt;%- theme.gitalk.admin %&gt;&apos;,</span><br><span class="line">            id: location.pathname,  // Ensure uniqueness and length less than 50</span><br><span class="line">            perPage: 50,</span><br><span class="line">            distractionFreeMode: &apos;&lt;%= theme.gitalk.distractionFreeMode %&gt;&apos;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        gitalk.render(&apos;gitalk-container&apos;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/section&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>
<p>参见 gitalk 的引用说明： <a href="https://github.com/gitalk/gitalk/blob/master/readme-cn.md#%E5%AE%89%E8%A3%85">Gitalk 安装</a><br>引入 <code>gitalk.css</code> 样式文件、<code>gitalk.min.js</code> js 源码文件<code>、</code>script` 标签中书写 gitalk 的 js 应用代码。<br>代码里面的 clientID 和 clientSecret 是上文中申请的应用里面的 id 和密钥。<br>repo 是评论加载的仓库名，记住只是仓库名，不是 git 克隆的地址，可以直接使用 hexo 部署的 xxx.github.io 仓库，也可以另外新建一个仓库。<br>owner 是评论仓库 repo 的持有者。<br>admin 是评论的管理员，可以填多个（数组），管理员是 GitHub repository 的所有者和合作者 (对这个 repository 有写权限的用户)，可以初始化文章评论。<br>id 是页面的唯一标识，一般来说一个文章的地址是唯一的，所以默认是 location.pathname 。不过 github issues 某次改版之后，这个值限制在50个字符内。<br>其他非必填字段，参考：<a href="https://github.com/gitalk/gitalk/blob/master/readme-cn.md#%E8%AE%BE%E7%BD%AE">gitalk 设置</a></p>
<h4 id="comment-ejs"><a href="#comment-ejs" class="headerlink" title="comment.ejs"></a>comment.ejs</h4><p>上文定义了 gitalk 插件的内容。要将插件引入进来，还需要修改 <code>comment.ejs</code> ，将 gitalk 引入进来。</p>
<p>参考 <code>themes/indigo/_partial/post/comment.ejs</code> 中其他部分，在其中添加一行代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;%- partial(&apos;../plugins/gitalk&apos;) %&gt;</span><br></pre></td></tr></table></figure>
<p>这样就会将 gitalk.ejs 的代码引入进页面。</p>
<h4 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h4><p>在 indigo 主题的配置文件 <code>themes/indigo/_config.yml</code> 中添加上文 js 需要引用到的变量</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># gitalk detail: https://github.com/gitalk/gitalk</span><br><span class="line">gitalk:</span><br><span class="line">  enable: true</span><br><span class="line">  client_id: xxx </span><br><span class="line">  client_secret: xxxx</span><br><span class="line">  repo: repo name # 仓库名</span><br><span class="line">  owner: repo owner # 仓库作者</span><br><span class="line">  admin: admins  # 管理员</span><br><span class="line">  distractionFreeMode: false</span><br></pre></td></tr></table></figure>
<h2 id="集成中的问题"><a href="#集成中的问题" class="headerlink" title="集成中的问题"></a>集成中的问题</h2><h3 id="gitalk-使用的-id-超限"><a href="#gitalk-使用的-id-超限" class="headerlink" title="gitalk 使用的 id 超限"></a>gitalk 使用的 id 超限</h3><p>gitalk 使用的是 github issues ，issues 在某次更新之后，labels 的长度限制在 50 以内，因此使用 location.pathname 很容易就超过 50 字的限制。</p>
<p>参考 <a href="https://github.com/gitalk/gitalk/issues/102">Gitalk Issues #102</a>:</p>
<p>使用 md5 进行路径的加密，这样就能保证 id 在 50 字以内，并且是唯一的。</p>
<ol>
<li>从 <a href="https://github.com/blueimp/JavaScript-MD5">blueimp/JavaScript-MD5</a> 中下载 <code>md5.min.js</code> .</li>
<li>将js放在 <code>themes/source/js</code> 目录下 </li>
<li><code>gitalk.ejs</code> 文件中引入 <code>&lt;script src=&quot;/js/md5.min.js&quot;&gt;&lt;/script&gt;</code></li>
<li>id 的配置改为 <code>md5(location.pathname)</code></li>
</ol>
<p>最终的 gitalk.ejs 配置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;% if (theme.gitalk.enable)&#123; %&gt;</span><br><span class="line">&lt;section class=&quot;comments&quot; id=&quot;comments&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;gitalk-container&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/gitalk/dist/gitalk.css&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;https://unpkg.com/gitalk/dist/gitalk.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/js/md5.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var gitalk = new Gitalk(&#123;</span><br><span class="line">            clientID: &apos;&lt;%- theme.gitalk.client_id %&gt;&apos;,</span><br><span class="line">            clientSecret: &apos;&lt;%- theme.gitalk.client_secret %&gt;&apos;,</span><br><span class="line">            repo: &apos;&lt;%- theme.gitalk.repo %&gt;&apos;,</span><br><span class="line">            owner: &apos;&lt;%- theme.gitalk.owner %&gt;&apos;,</span><br><span class="line">            admin: &apos;&lt;%- theme.gitalk.admin %&gt;&apos;,</span><br><span class="line">            id: md5(location.pathname),</span><br><span class="line">            perPage: 50,</span><br><span class="line">            distractionFreeMode: &apos;&lt;%= theme.gitalk.distractionFreeMode %&gt;&apos;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        gitalk.render(&apos;gitalk-container&apos;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/section&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>
<p>这样在 github issues 页面就可以看见一串 md5 的 label ，并且评论不会因为 50 字限制而出现问题</p>
<h3 id="id-使用-pathname-而不要使用-href"><a href="#id-使用-pathname-而不要使用-href" class="headerlink" title="id 使用 pathname 而不要使用 href"></a>id 使用 pathname 而不要使用 href</h3><p>根据 <a href="https://github.com/gitalk/gitalk/issues/102">Gitalk Issues #102</a> 反馈，有些人使用微信浏览器时，url中会带有微信部分特征 url ，这会导致计算 md5 时出现异常。<br>这是因为引入 gitalk 时使用的是 location.href ，因为 href 是整个 url，而 pathname 是 url 中请求映射的部分，不带域名或者 IP 端口部分的地址，这样会屏蔽掉微信等方式导致的 id 计算异常。</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>希望 gitalk 可以让我少折腾一点评论系统。如果频繁的改动评论系统，会丢失多少重要的数据，这些数据都是很宝贵的。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-05-12T01:17:23.859Z" itemprop="dateUpdated">2020-05-12 01:17:23</time>
</span><br>


        
        版权所有，未经允许，禁止转载，原文链接：<a href="/2018/10/03/Hexo博客添加评论系统/" target="_blank" rel="external">/2018/10/03/Hexo博客添加评论系统/</a>
        
    </div>
    
    <footer>
        <a href="https://github.com/zzycreate">
            <img src="/img/avatar.jpg" alt="zzycreate">
            zzycreate
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitalk/">gitalk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/博客/">博客</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/教程/">教程</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/评论/">评论</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/&title=《Hexo博客添加评论系统》 — ZZY补完计划&pic=https://github.com/zzycreate/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/&title=《Hexo博客添加评论系统》 — ZZY补完计划&source=
很多人写博客的目的是给自己做记录的，例如我，但是一个使用难免会有些寂寞，有时候会想要让跟多人看见自己的成果，这时候就需要可以互动评论的系统。现在的博客评..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Hexo博客添加评论系统》 — ZZY补完计划&url=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/&via=https://github.com/zzycreate" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/10/10/个人Linux使用命令记录/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">个人Linux使用命令记录</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/10/02/Hexo博客折腾记/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Hexo博客折腾记</h4>
      </a>
    </div>
  
</nav>



    














<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script src="/js/md5.min.js"></script>
    <script>
        var gitalk = new Gitalk({
            clientID: '7906a78d4432812755c9',
            clientSecret: '24740aadb58844e7c4c870d96d6ad472b8ec67e1',
            repo: 'blog-comments',
            owner: 'zzycreate',
            admin: 'zzycreate',
            id: md5(location.pathname),
            perPage: 50,
            distractionFreeMode: 'false'
        })

        gitalk.render('gitalk-container')
    </script>
</section>







</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <!--
        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
        -->
    </div>
    <div class="bottom">
        <p><span>zzycreate &copy; 2016 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/&title=《Hexo博客添加评论系统》 — ZZY补完计划&pic=https://github.com/zzycreate/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/&title=《Hexo博客添加评论系统》 — ZZY补完计划&source=
很多人写博客的目的是给自己做记录的，例如我，但是一个使用难免会有些寂寞，有时候会想要让跟多人看见自己的成果，这时候就需要可以互动评论的系统。现在的博客评..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Hexo博客添加评论系统》 — ZZY补完计划&url=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/&via=https://github.com/zzycreate" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://github.com/zzycreate/2018/10/03/Hexo博客添加评论系统/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACuUlEQVR42u3aQXJiMQwE0Nz/0jMHIN90WzZh8VhRhDh+pMoyLf38xI9/D4/Xnz69/3W11+fJHn5uPPDw8PAObf1pE/l71qSWvd7D05p4eHh493jrg3h9KK9XePzDwWr5x/f4Oh4eHt7X8JKL9eSivHcRx8PDw/s23hqZXHnnv4WHh4f3PbxJUDsvHnvBx+GsBQ8PDy/m3QgIbj+/0t/Dw8PDG3fV26ttfu1ODvF2nV9WxsPDw7vA2xsdyEPb9XsScPv6L7vFw8PDO8qbB6mTsGDvG0BSWvDw8PDu8drRqHxzbYFpy08xsoCHh4d3lDePG5LDPQ8j2jbbm/3g4eHhXeO1C+XX6DyQbS/00St4eHh4H+e1m2uHX9sBhfYfgIeHh3eDl7ft8wAijwwmJWESlODh4eHNeXmDfxI01Ony4L+Eh4eHd4+XX45zwGTIYLICHh4e3md47UGfb6uNDzZrWvmVAA8PD+8Ur910Erm2Lat5wXjE4+Hh4V3mTQ73vWCiBbRjCnh4eHhnefUhGze69hpmeVwbRRV4eHh4F3h7C+XgtsW11zZ7U0jw8PDwjvLaiGGv7bQ+xPMxgnwoYTNBwcPDw4t5a0B7Ld6LNpLgOPkQ6zACDw8Pb4uXR657gMlIVlLGHosWHh4e3gVeWx72woKkVZaEFHuDXHh4eHif5O1dc+dxw+RiXVchPDw8vDGvPehz0o0YIhpTwMPDw/sI72xoO4khigLQziPg4eHhDWD5IzmU20GE6HAvL+tvUmo8PDy8AW9yxk421IYjex8WHh4e3j1eUgzaNtgaP490i4AYDw8P7xqvHQhow9a88X84TMHDw8P7Sl6+6b1LeV5aHq/UeHh4eH/Kay+1k+Gttp91oDDg4eHhxbwWkLTHJux5+w0PDw/vHm/yhT9vgE0+lHaECw8PD+8a7z+Nb5eEjYg9rwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdnjs.cloudflare.com/ajax/libs/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'ZZY补完计划';
            clearTimeout(titleTime);
        } else {
            document.title = 'ZZY补完计划';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
